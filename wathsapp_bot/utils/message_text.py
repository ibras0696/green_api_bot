from datetime import datetime, timedelta

import pytz

welcome_message = """
üé¨ –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ –ö–∏–Ω–æ –ë–æ—Ç! 

–Ø –ø–æ–º–æ–≥—É –Ω–∞–π—Ç–∏ –ª—é–±–æ–π —Ñ–∏–ª—å–º –∏ –¥–∞–º –ø—Ä—è–º—É—é —Å—Å—ã–ª–∫—É –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞.  
–ü—Ä–æ—Å—Ç–æ –≤–≤–µ–¥–∏ –Ω–∞–∑–≤–∞–Ω–∏–µ, –Ω–∞–ø—Ä–∏–º–µ—Ä:  
    ‚Üí ¬´–ò–Ω—Ç–µ—Ä—Å—Ç–µ–ª–ª–∞—Ä¬ª  


‚ú® –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏:  
    - –ü—Ä—è–º–∞—è —Å—Å—ã–ª–∫–∞ –Ω–∞ —Ñ–∏–ª—å–º (—Å—Ä–∞–∑—É –∫ –ø—Ä–æ—Å–º–æ—Ç—Ä—É)  
    - –ö–∞—á–µ—Å—Ç–≤–æ: 480p, 720p, 1080p  
    - –í—ã–±–æ—Ä –æ–∑–≤—É—á–∫–∏: –æ—Ä–∏–≥–∏–Ω–∞–ª, –¥—É–±–ª—è–∂, –º–Ω–æ–≥–æ–≥–æ–ª–æ—Å—ã–π  
    - –ú–∏–Ω–∏–º—É–º —Ä–µ–∫–ª–∞–º—ã  

üéÅ –ù–æ–≤—ã–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º:  
    5 –¥–Ω–µ–π –±–µ—Å–ø–ª–∞—Ç–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞!  

üìã –ö–æ–º–∞–Ω–¥—ã:  
    000 ‚Äì –ú–µ–Ω—é –ë–æ—Ç–∞   

–ù–∞—Å–ª–∞–∂–¥–∞–π—Å—è –∫–∏–Ω–æ! üé•üçø  
""".strip()

commands_text = '''
üìã –ö–æ–º–∞–Ω–¥—ã:  
    000 ‚Äì –ú–µ–Ω—é –ë–æ—Ç–∞ 
'''.strip()
subscription_is_not_text = """
üìõ –í–∞—à–∞ –ø–æ–¥–ø–∏—Å–∫–∞ –∑–∞–∫–æ–Ω—á–∏–ª–∞—Å—å

–î–æ—Å—Ç—É–ø –∫ –±–æ—Ç—É –≤—Ä–µ–º–µ–Ω–Ω–æ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω.
–ß—Ç–æ–±—ã –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø–æ–ª–Ω—ã–π –¥–æ—Å—Ç—É–ø:

üîÑ –ü—Ä–æ–¥–ª–∏—Ç–µ –ø–æ–¥–ø–∏—Å–∫—É - –Ω–∞–∂–º–∏—Ç–µ 00

–ü–æ—Å–ª–µ –æ–ø–ª–∞—Ç—ã –¥–æ—Å—Ç—É–ø –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤ —Ç–µ—á–µ–Ω–∏–µ 1 –º–∏–Ω—É—Ç—ã.
""".strip()


def profile_message(whatsapp_id: str, day_count: int, is_active: str, created_at) -> str:
    moscow_tz = pytz.timezone('Europe/Moscow')

    # –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º —Å—Ç—Ä–æ–∫—É –≤ datetime, –µ—Å–ª–∏ –Ω—É–∂–Ω–æ
    if isinstance(created_at, str):
        created_at = datetime.strptime(created_at, '%Y-%m-%d %H:%M:%S.%f')

    # –ï—Å–ª–∏ –¥–∞—Ç–∞ –±–µ–∑ timezone, —Å—á–∏—Ç–∞–µ–º —á—Ç–æ —ç—Ç–æ UTC (–∏–ª–∏ –∏—Å—Ö–æ–¥–Ω–æ–µ) –∏ –¥–µ–ª–∞–µ–º aware
    if created_at.tzinfo is None:
        created_at = pytz.utc.localize(created_at)

    # –ü–µ—Ä–µ–≤–æ–¥–∏–º –≤–æ –≤—Ä–µ–º–µ–Ω–Ω—É—é –∑–æ–Ω—É –ú–æ—Å–∫–≤—ã
    moscow_date = created_at.astimezone(moscow_tz)

    # –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ–º
    start_formatted = moscow_date.strftime('%d.%m.%Y')
    end_date = moscow_date + timedelta(days=day_count)
    end_formatted = end_date.strftime('%d.%m.%Y')

    return f"""
üìÖ –í–∞—à –ø—Ä–æ—Ñ–∏–ª—å

    üÜî WhatsApp: {whatsapp_id}
    üìÖ –î–∞—Ç–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏: {start_formatted}
    üìõ –î–∞—Ç–∞ –æ–∫–æ–Ω—á–∞–Ω–∏—è –ø–æ–¥–ø–∏—Å–∫–∏: {end_formatted}
    üîê –°—Ç–∞—Ç—É—Å: {is_active}
    ‚è≥ –î–Ω–µ–π –ø–æ–¥–ø–∏—Å–∫–∏: {day_count}

üõ† –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:
    000 ‚Äì –ú–µ–Ω—é –ë–æ—Ç–∞ 
"""